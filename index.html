<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>希伯来历史复习 v5.4 (键盘适配版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body, html { 
            height: 100%;
            overflow: hidden; /* 防止iOS橡皮筋效果 */
            -webkit-tap-highlight-color: transparent; 
            background-color: #f8fafc; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }
        #root {
            height: 100%;
        }
        .input-highlight:focus { 
            transform: scale(1.02); 
            background-color: #ffffff; 
            border-color: #4338ca; 
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
        .glass-header { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px); }
        
        /* 针对不同屏幕高度的微调 */
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#4338ca', secondary: '#be185d' }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // 图标组件
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
        );
        const Icons = {
            Home: (p) => <Icon {...p} path={<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>} />,
            Book: (p) => <Icon {...p} path={<><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></>} />,
            Save: (p) => <Icon {...p} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>} />,
            RotateCcw: (p) => <Icon {...p} path={<><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></>} />,
            Check: (p) => <Icon {...p} path={<polyline points="20 6 9 17 4 12"/>} />,
            X: (p) => <Icon {...p} path={<><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>} />,
            Eye: (p) => <Icon {...p} path={<><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></>} />,
            EyeOff: (p) => <Icon {...p} path={<><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07-2.3 2.3"/><line x1="1" y1="1" x2="23" y2="23"/></>} />,
            ChevronRight: (p) => <Icon {...p} path={<polyline points="9 18 15 12 9 6"/>} />,
            AlertCircle: (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></>} />,
            ArrowLeft: (p) => <Icon {...p} path={<><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></>} />,
            Award: (p) => <Icon {...p} path={<><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></>} />,
        };

        // -----------------------------------------------------------------------------
        // 核心题库：100% 覆盖 PPT
        // -----------------------------------------------------------------------------
        const rawQuestions = [
            // ==================== 1. 经文背诵 (多变体) ====================
            // 罗马书 15:4
            { category: "经文背诵", question: "罗马书 15:4\n从前所写的圣经都是为{教训}我们写的，叫我们因圣经所生的忍耐和安慰可以得着盼望。" },
            { category: "经文背诵", question: "罗马书 15:4\n从前所写的圣经都是为教训我们写的，叫我们因圣经所生的{忍耐}和{安慰}可以得着盼望。" },
            { category: "经文背诵", question: "罗马书 15:4\n叫我们因圣经所生的忍耐和安慰可以得着{盼望}。" },

            // 约书亚记 1:1-3
            { category: "经文背诵", question: "约书亚记 1:3\n凡你们{脚掌}所踏之地，我都照着我所应许摩西的话赐给你们了。" },
            { category: "经文背诵", question: "约书亚记 1:3\n凡你们脚掌所踏之地，我都照着我所应许{摩西}的话赐给你们了。" },
            { category: "经文背诵", question: "约书亚记 1:3\n凡你们脚掌所踏之地，我都照着我所{应许}摩西的话赐给你们了。" },

            // 约书亚记 4:7
            { category: "经文背诵", question: "约书亚记 4:7\n你们就对他们说：这是因为约旦河的水在耶和华的{约柜}前断绝。" },
            { category: "经文背诵", question: "约书亚记 4:7\n这些石头要作{以色列人}永远的{纪念}。" },

            // 约书亚记 24:15
            { category: "经文背诵", question: "约书亚记 24:15\n至于{我和我家}，我们必定侍奉耶和华。" },
            { category: "经文背诵", question: "约书亚记 24:15\n至于我和我家，我们必定{侍奉}耶和华。" },

            // 路得记 1:16-17
            { category: "经文背诵", question: "路得记 1:16\n不要{催}我回去不跟随你。" },
            { category: "经文背诵", question: "路得记 1:16\n你的国就是{我的国}，你的神就是{我的神}。" },
            { category: "经文背诵", question: "路得记 1:17\n你在哪里{死}，我也在那里死，也{葬}在那里。" },

            // ==================== 2. 历史五要素 & 民族定义 ====================
            { 
                category: "历史导论", 
                type: "list",
                question: "学习历史的五要素：\n1. {时间}\n2. {地点}\n3. {人物}\n4. {背景}（或事件）\n5. {意义}" 
            },
            { 
                category: "名词定义", 
                type: "list",
                question: "希伯来人：\n1. 旧约中，指{闪}的后裔，特指{亚伯拉罕}及其后代。\n2. 原意是「{渡河}而来的人」，是原住民对外来者的称呼。\n3. 新约中，指说{希伯来话}的犹太人。" 
            },
            { 
                category: "名词定义", 
                type: "list",
                question: "以色列人：\n1. 早期历史中，指以色列的{12}个支派。\n2. 源于雅各在创世记32章被神更名。\n3. 现代指具有{以色列国籍}的人。" 
            },
            { 
                category: "名词定义", 
                type: "list",
                question: "犹太人：\n1. 词汇来源于“犹大” - 雅各的第{4}个儿子 - 犹大支派。\n2. 国家分裂后，犹大成为{南国}的名称。\n3. 犹太是希腊语-拉丁语中对“{犹大}”的拼写。" 
            },

            // ==================== 3. 亚伯拉罕 (7大事件) ====================
            { 
                category: "亚伯拉罕", 
                type: "list",
                question: "亚伯拉罕主要事迹 (4-5)：\n4. 被神{更名}（创 17）。\n5. 为{所多玛}城代求（创 18-19）。" 
            },
            { 
                category: "亚伯拉罕", 
                type: "list",
                question: "亚伯拉罕主要事迹 (6-7)：\n6. 以撒出生 - {试验}临到（创 21-22）。\n7. 遣仆人为{以撒}去本族娶妻（创 24）。" 
            },

            // ==================== 4. 雅各 (7大事件) ====================
            { 
                category: "雅各", 
                type: "list",
                question: "雅各主要事迹 (1-3)：\n1. 一碗{红豆汤}得长子名分（创 25）。\n2. 计骗{父亲}的祝福（创 27）。\n3. 为{拉结}和{利亚}服事拉班（创 29）。" 
            },
            { 
                category: "雅各", 
                type: "list",
                question: "雅各主要事迹 (4-5)：\n4. 雅各的子女（创 29-30；35）。\n5. 雅各被{更名}（创 32）。" 
            },
            { 
                category: "雅各", 
                type: "list",
                question: "雅各主要事迹 (6-7)：\n6. 在{伯特利}筑坛，蒙神的祝福和应许（创 35）。\n7. 与{列祖}同葬一处（创 49）。" 
            },

            // ==================== 5. 摩西 (7大事件) ====================
            { 
                category: "摩西", 
                type: "list",
                question: "摩西主要事迹 (1-3)：\n1. 属于{利未}支派，在埃及长大（出 1-2）。\n2. 神在{何烈}山荆棘火焰中向他显现（出 3）。\n3. 推脱得哥哥{亚伦}为助手（出 4）。" 
            },
            { 
                category: "摩西", 
                type: "list",
                question: "摩西主要事迹 (4-5)：\n4. 行{10}灾的神迹（出 7-12）。\n5. 带领以色列人过{红海}（出 14）。" 
            },
            { 
                category: "摩西", 
                type: "list",
                question: "摩西主要事迹 (6-7)：\n6. 带领以色列人到{西乃}山见神得十诫（出 19-20）。\n7. 被神指示造{法柜}和{帐幕}（出 25-40）。" 
            },

            // ==================== 6. 约书亚 (7点介绍) ====================
            { 
                category: "约书亚", 
                type: "list",
                question: "约书亚其人 (1-3)：\n1. 名字义：「{耶和华}的救恩」，与希腊文「{耶稣}」同义。\n2. 出身于{以法莲}支派，原名{何西阿}。\n3. 曾率军在{利非订}打败亚玛力人。" 
            },
            { 
                category: "约书亚", 
                type: "list",
                question: "约书亚其人 (4-5)：\n4. 在{西乃}山期间，充当摩西的随从帮手。\n5. 曾与{迦勒}一起力抗十名探子的悲观论调。" 
            },
            { 
                category: "约书亚", 
                type: "list",
                question: "约书亚其人 (6-7)：\n6. 被选为摩西的{继任人}，带领百姓征服迦南。\n7. 共活了{110}岁。" 
            },

            // ==================== 7. 约书亚记事件 ====================
            { category: "约书亚记", question: "大纲：\n1. 继承摩西\n2. 两个探子\n3. 过{约旦河}\n4. 耶和华的{军队}准备出击（第五章）。" },
            { category: "领袖传承", question: "蒙福条件：刚强壮胆，{谨守诫命}。\n最大鼓励：{神必同在}。" },

            { 
                category: "喇合", 
                type: "list",
                question: "喇合一家得救的3个条件：\n1. {红绳}系在窗户上。\n2. {守在}家中。\n3. 不可{泄露秘密}。" 
            },
            { 
                category: "过约旦河", 
                type: "list", 
                question: "过河细节：\n1. {祭司}抬起约柜在百姓前头走。\n2. 祭司的脚一入水，{水便停住}。\n3. 立{12}块石头：作为永远的{纪念}。" 
            },
            { 
                category: "吉甲", 
                type: "list",
                question: "吉甲的4件大事：\n1. 行割礼（因新一代未行）。\n2. 吉甲意思是{滚}。\n3. 守{逾越节}。\n4. 次日吃土产，{吗哪}停止。" 
            },
            { 
                category: "耶利哥", 
                type: "list",
                question: "征服耶利哥：\n1. 前六日每日绕城{1}次。\n2. {7}个祭司拿{7}个羊角。\n3. 第七日绕城{7}次，祭司吹角，百姓{呼喊}。" 
            },
            { category: "艾城", question: "第一次攻艾城失败，因{亚干}犯罪。" },
            
            // --- 基利心山与以巴路山 (强化版) ---
            { 
                category: "艾城", 
                type: "list", 
                question: "攻取艾城后的仪式：\n1. 一半人对着{基利心}山。\n2. 一半人对着{以巴路}山。\n3. 应验了{摩西}在申命记所说的话。" 
            },
            { 
                category: "艾城", 
                type: "list",
                question: "两座山的属灵含义：\n1. 基利心山：象征{顺服}律法的人（代表祝福）。\n2. 以巴路山：象征{不顺服}律法的人（代表咒诅）。" 
            },

            { category: "基遍", question: "以色列人被骗与{基遍}人立约。\n根本原因：没有{求问耶和华}！" },

            // ==================== 8. 总结与分地 ====================
            { category: "杀王总结", question: "摩西带领击杀二王：亚摩利王{西宏}、巴珊王{噩}。" },
            { category: "杀王总结", question: "约书亚带领击杀了{31}个王（南部16，北部15）。" },
            { 
                category: "分地", 
                type: "list",
                question: "分地概况：\n1. 约旦河{东}：流便、迦得、玛拿西半支派。\n2. 约旦河西：其余{9}个半支派。\n3. {利未}支派不分地，产业是侍奉耶和华。" 
            },
            { category: "分地", question: "会幕从吉甲移到了{示罗}。" },
            { category: "分地", question: "设立{逃城}，使那无心而误杀人的可以逃到那里。" },

            // ==================== 9. 士师记 ====================
            { category: "士师记", question: "基甸：奉命拆毁{巴力}的祭坛，因此得名{耶路巴力}。" },
            { category: "士师记", question: "耶弗他：作士师{6}年。" },
            
            { 
                category: "士师记腐败", 
                type: "list",
                question: "信仰的腐败：\n1. 米迦的母亲崇拜偶像（出于己意的崇拜）。\n2. 只有宗教形式（神庙、祭司），没有{实意}。\n3. 商业主义：利未人求{10}舍客勒银子、一套衣服。" 
            },
            { 
                category: "士师记腐败", 
                type: "list",
                question: "道德的腐败：\n1. 利未人纳{妾}。\n2. 同性恋行为。\n3. {基比亚}匪徒凌辱其妾致死。\n4. 尸身被切成{12}块送往四境。" 
            },
            { 
                category: "士师记腐败", 
                type: "list",
                question: "政治的腐败：\n1. 便雅悯支派态度顽梗，导致残酷{内战}。\n2. 以色列人鲁莽{起誓}（不求问神）。" 
            },
            { category: "士师记", question: "士师记结语：\n那时以色列中没有{王}，各人{任意而行}。" },

            // ==================== 10. 路得记 ====================
            { 
                category: "路得记", 
                type: "list",
                question: "路得记的四个阶段：\n1. 第一章：到了波阿斯的『{城}』里。\n2. 第二章：到了波阿斯的『{田}』里。\n3. 第三章：到了波阿斯的『{场}』上。\n4. 第四章：到了波阿斯的『{家}』里。" 
            },
            { category: "路得记", question: "路得生子归拿俄米，其曾孙是{大卫}王。" }
        ];

        // -----------------------------------------------------------------------------
        // 逻辑部分 (Shuffle, Parse, State)
        // -----------------------------------------------------------------------------
        const shuffle = (array) => {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        };

        const parseQuestion = (qStr, id) => {
            const lines = qStr.question.split('\n');
            const parsedLines = lines.map(line => {
                const parts = [];
                let lastIndex = 0;
                const regex = /\{([^}]+)\}/g;
                let match;
                while ((match = regex.exec(line)) !== null) {
                    if (match.index > lastIndex) {
                        parts.push({ type: 'text', content: line.substring(lastIndex, match.index) });
                    }
                    parts.push({ type: 'input', answer: match[1] });
                    lastIndex = regex.lastIndex;
                }
                if (lastIndex < line.length) {
                    parts.push({ type: 'text', content: line.substring(lastIndex) });
                }
                return parts;
            });
            return {
                id,
                category: qStr.category,
                isList: lines.length > 1 || qStr.type === 'list',
                lines: parsedLines,
            };
        };

        const parsedQuestions = rawQuestions.map((q, i) => parseQuestion(q, i));

        // -----------------------------------------------------------------------------
        // React App 组件
        // -----------------------------------------------------------------------------
        function App() {
            const [view, setView] = React.useState('home');
            const [questions, setQuestions] = React.useState([]);
            const [currentIndex, setCurrentIndex] = React.useState(0);
            const [inputs, setInputs] = React.useState({});
            const [showResult, setShowResult] = React.useState(false);
            const [wrongQuestionIds, setWrongQuestionIds] = React.useState(new Set());
            const [mode, setMode] = React.useState('all'); 
            const [stats, setStats] = React.useState({ correct: 0, total: 0 });
            const [showHint, setShowHint] = React.useState(false);

            React.useEffect(() => {
                const savedWrong = localStorage.getItem('hebrewHistory_wrongIds_final_v52');
                if (savedWrong) setWrongQuestionIds(new Set(JSON.parse(savedWrong)));
            }, []);

            React.useEffect(() => {
                localStorage.setItem('hebrewHistory_wrongIds_final_v52', JSON.stringify([...wrongQuestionIds]));
            }, [wrongQuestionIds]);

            const startExam = (newMode) => {
                setMode(newMode);
                let qPool = newMode === 'review' ? parsedQuestions.filter(q => wrongQuestionIds.has(q.id)) : [...parsedQuestions];
                if (newMode === 'review' && qPool.length === 0) return;
                setQuestions(shuffle(qPool));
                setCurrentIndex(0);
                setInputs({});
                setShowResult(false);
                setShowHint(false);
                setStats({ correct: 0, total: 0 });
                setView('quiz');
            };

            const goHome = () => setView('home');
            const handleInputChange = (key, value) => setInputs(prev => ({ ...prev, [key]: value }));

            // -------------------------------------------------------
            // 核心判题逻辑
            // -------------------------------------------------------
            const isAnswerCorrect = (userVal, correctVal, category) => {
                if (category === '经文背诵') {
                    return (userVal || '').trim() === correctVal.trim();
                }

                let u = (userVal || '').trim().replace(/\s+/g, '').toLowerCase();
                let c = correctVal.trim().replace(/\s+/g, '').toLowerCase();
                
                if (!u) return false;
                if (u === c) return true;

                const equivalentGroups = [
                    ['1', '一'], ['2', '二', '两'], ['3', '三'], ['4', '四'], 
                    ['5', '五'], ['6', '六'], ['7', '七'], ['9', '九'], 
                    ['10', '十'], ['12', '十二'], ['15', '十五'], 
                    ['31', '三十一'], ['110', '一百一十'],
                    ['耶和华', '神', '上帝'],
                    ['纪念', '记念'],
                    ['起誓', '发誓'],
                    ['顺服', '顺服神', '顺服耶和华'],
                    ['不顺服', '不顺服神', '不顺服耶和华', '背逆'],
                    ['背景', '事件'],
                    ['意义', '含义'],
                    ['时间', '年代'],
                    ['求问耶和华', '求问神', '祷告', '求问'],
                    ['应许', '允许', '承诺']
                ];

                for (let group of equivalentGroups) {
                    if (group.includes(c) && group.includes(u)) return true;
                }

                if (u.includes(c)) return true;
                if (c.includes(u)) {
                    if (u.length >= 2) return true;
                    const singleCharWhitelist = ['王', '东', '滚', '死', '葬', '闪', '田', '城', '场', '家', '妾'];
                    if (singleCharWhitelist.includes(u)) return true;
                    if (/^[\u4e00-\u9fa5]$/.test(u)) return true;
                }
                
                return false;
            };

            const checkCurrentQuestion = () => {
                const currentQ = questions[currentIndex];
                return currentQ.lines.every((line, lineIdx) => 
                    line.every((part, partIdx) => 
                        part.type !== 'input' || isAnswerCorrect(inputs[`${lineIdx}-${partIdx}`], part.answer, currentQ.category)
                    )
                );
            };

            const handleSubmit = () => {
                const isCorrect = checkCurrentQuestion();
                const currentQ = questions[currentIndex];
                setStats(prev => ({ ...prev, total: prev.total + 1, correct: prev.correct + (isCorrect ? 1 : 0) }));
                if (isCorrect) {
                    if (wrongQuestionIds.has(currentQ.id)) {
                        const newSet = new Set(wrongQuestionIds);
                        newSet.delete(currentQ.id);
                        setWrongQuestionIds(newSet);
                    }
                } else {
                    setWrongQuestionIds(prev => new Set(prev).add(currentQ.id));
                }
                setShowResult(true);
            };

            const nextQuestion = () => {
                if (currentIndex < questions.length - 1) {
                    setCurrentIndex(prev => prev + 1);
                    setInputs({});
                    setShowResult(false);
                    setShowHint(false);
                    setTimeout(() => document.querySelector('input')?.focus(), 100);
                } else {
                    setView('result');
                }
            };

            // --- 渲染部分 ---

            if (view === 'home') {
                return (
                    <div className="h-full flex flex-col items-center justify-center p-6 animate-slide-up">
                        <div className="w-24 h-24 bg-gradient-to-br from-indigo-600 to-purple-700 rounded-3xl shadow-xl flex items-center justify-center mb-6">
                            <Icons.Book className="w-12 h-12 text-white" />
                        </div>
                        <h1 className="text-3xl font-black text-slate-900 mb-2 tracking-tight">希伯来历史</h1>
                        <p className="text-lg text-slate-500 mb-10 text-center font-medium">全考点复习助手<br/>v5.4 键盘适配版</p>

                        <div className="w-full max-w-sm space-y-4">
                            <button onClick={() => startExam('all')} className="w-full flex items-center p-6 bg-white border-2 border-indigo-50 rounded-2xl shadow-sm active:scale-95 transition-all group">
                                <div className="w-14 h-14 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-700 mr-5 group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                                    <Icons.RotateCcw className="w-8 h-8" />
                                </div>
                                <div className="text-left flex-1">
                                    <div className="font-bold text-slate-900 text-xl">全题库练习</div>
                                    <div className="text-slate-500 text-base">共 {parsedQuestions.length} 题</div>
                                </div>
                                <Icons.ChevronRight className="w-6 h-6 text-slate-300" />
                            </button>

                            <button onClick={() => startExam('review')} disabled={wrongQuestionIds.size === 0} 
                                className={`w-full flex items-center p-6 border-2 rounded-2xl shadow-sm active:scale-95 transition-all group ${wrongQuestionIds.size > 0 ? 'bg-white border-pink-50 cursor-pointer' : 'bg-slate-100 border-transparent opacity-60 cursor-not-allowed'}`}>
                                <div className={`w-14 h-14 rounded-full flex items-center justify-center mr-5 transition-colors ${wrongQuestionIds.size > 0 ? 'bg-pink-50 text-pink-600 group-hover:bg-pink-600 group-hover:text-white' : 'bg-slate-200 text-slate-400'}`}>
                                    <Icons.AlertCircle className="w-8 h-8" />
                                </div>
                                <div className="text-left flex-1">
                                    <div className="font-bold text-slate-900 text-xl">复习错题本</div>
                                    <div className="text-slate-500 text-base">{wrongQuestionIds.size > 0 ? `${wrongQuestionIds.size} 题待复习` : '暂无错题'}</div>
                                </div>
                                {wrongQuestionIds.size > 0 && <Icons.ChevronRight className="w-6 h-6 text-slate-300" />}
                            </button>
                        </div>
                    </div>
                );
            }

            if (view === 'result') {
                return (
                    <div className="h-full flex flex-col items-center justify-center p-6 animate-slide-up">
                        <div className="w-24 h-24 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-6">
                            <Icons.Award className="w-12 h-12" />
                        </div>
                        <h2 className="text-3xl font-black text-slate-900 mb-2">练习完成!</h2>
                        <p className="text-lg text-slate-500 mb-10 font-bold">正确率 {stats.total === 0 ? 0 : Math.round((stats.correct/stats.total)*100)}%</p>
                        
                        <div className="grid grid-cols-2 gap-4 w-full max-w-sm mb-10">
                            <div className="bg-white border-2 border-indigo-50 p-6 rounded-2xl text-center shadow-sm">
                                <div className="text-sm font-black text-indigo-500 uppercase mb-1">答对</div>
                                <div className="text-4xl font-black text-slate-900">{stats.correct}</div>
                            </div>
                            <div className="bg-white border-2 border-pink-50 p-6 rounded-2xl text-center shadow-sm">
                                <div className="text-sm font-black text-pink-500 uppercase mb-1">错题</div>
                                <div className="text-4xl font-black text-slate-900">{wrongQuestionIds.size}</div>
                            </div>
                        </div>

                        <div className="w-full max-w-sm space-y-4">
                            <button onClick={() => startExam('review')} disabled={wrongQuestionIds.size === 0} className="w-full py-5 bg-pink-700 text-white rounded-2xl text-xl font-bold disabled:opacity-50 shadow-lg shadow-pink-200 active:scale-95 transition-transform flex items-center justify-center gap-2">
                                <Icons.RotateCcw className="w-6 h-6"/> 继续攻克错题
                            </button>
                            <button onClick={goHome} className="w-full py-5 bg-white border-2 border-slate-200 text-slate-700 rounded-2xl text-xl font-bold hover:bg-slate-50 active:scale-95 transition-transform flex items-center justify-center gap-2">
                                <Icons.Home className="w-6 h-6"/> 返回首页
                            </button>
                        </div>
                    </div>
                );
            }

            const currentQ = questions[currentIndex];
            if (!currentQ) return <div className="h-full flex items-center justify-center text-slate-400 text-xl font-bold">正在加载题库...</div>;

            return (
                <div className="flex flex-col h-screen bg-slate-100 font-sans">
                    <header className="flex-none h-14 glass-header border-b border-slate-200/60 shadow-sm z-20">
                        <div className="max-w-2xl mx-auto px-4 h-full flex items-center justify-between">
                            <button onClick={goHome} className="p-2 -ml-2 text-slate-500 hover:text-indigo-600 rounded-xl flex items-center gap-1 active:bg-slate-100">
                                <Icons.ArrowLeft className="w-5 h-5"/> <span className="text-sm font-bold">首页</span>
                            </button>
                            <div className="text-sm font-bold text-slate-800">
                                {currentIndex + 1} <span className="text-slate-300 mx-1">/</span> {questions.length}
                            </div>
                            <span className={`px-2 py-1 rounded-lg text-xs font-black ${mode === 'review' ? 'bg-pink-100 text-pink-700' : 'bg-indigo-100 text-indigo-700'}`}>
                                {mode === 'review' ? '错题' : '全题'}
                            </span>
                        </div>
                        <div className="h-1 bg-slate-200/50 w-full"><div className="h-full bg-indigo-600 transition-all duration-300 rounded-r-full" style={{ width: `${((currentIndex + 1) / questions.length) * 100}%` }}></div></div>
                    </header>

                    <main className="flex-1 overflow-y-auto p-4 pb-20 scroll-smooth">
                         <div className="w-full max-w-2xl mx-auto flex flex-col gap-6">
                            
                            {/* Card */}
                            <div className="bg-white rounded-2xl shadow-md border border-slate-100 overflow-hidden animate-slide-up">
                                <div className="bg-slate-50/80 px-4 py-3 border-b border-slate-100 flex justify-between items-center">
                                    <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">题目类型</span>
                                    <span className="text-[10px] font-black text-indigo-700 bg-indigo-50 px-2 py-1 rounded-lg border border-indigo-100">{currentQ.category}</span>
                                </div>
                                
                                <div className="p-6 sm:p-10">
                                    <div className="flex flex-col justify-center gap-4 sm:gap-6 min-h-0">
                                        {currentQ.lines.map((line, lIdx) => (
                                            <div key={lIdx} className={`text-lg sm:text-xl leading-loose ${currentQ.isList && lIdx === 0 && !line.some(p => p.type === 'input') ? 'font-bold text-slate-900 border-b-2 border-slate-100 pb-2 mb-2' : 'font-semibold text-slate-700'}`}>
                                                {line.map((part, pIdx) => {
                                                    if (part.type === 'text') return <span key={pIdx}>{part.content}</span>;
                                                    const key = `${lIdx}-${pIdx}`;
                                                    const val = inputs[key] || '';
                                                    const correct = isAnswerCorrect(val, part.answer, currentQ.category);
                                                    if (showResult) return (
                                                        <span key={pIdx} className={`mx-1 px-2 py-0.5 rounded-lg border inline-flex items-center gap-1 align-middle text-base ${correct ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800 line-through decoration-2'}`}>
                                                            {!correct && <span className="absolute -mt-8 bg-white text-xs text-red-600 px-2 py-0.5 border border-red-100 rounded shadow whitespace-nowrap z-10 font-bold">你的答案: {val || '空'}</span>}
                                                            {part.answer}
                                                        </span>
                                                    );
                                                    return (
                                                        <input key={pIdx} type="text" value={val} onChange={e => handleInputChange(key, e.target.value)} 
                                                            placeholder={showHint ? part.answer : ''}
                                                            className={`mx-1 min-w-[60px] w-[100px] sm:w-[140px] h-10 sm:h-12 text-center text-lg font-bold border-b-2 sm:border-b-4 bg-indigo-50/40 focus:bg-white focus:outline-none rounded-t-lg px-1 text-indigo-900 input-highlight transition-all placeholder:text-slate-300 align-middle ${val ? 'border-indigo-500 bg-indigo-50/60' : 'border-slate-300'}`} 
                                                            autoComplete="off" 
                                                        />
                                                    );
                                                })}
                                            </div>
                                        ))}
                                    </div>
                                    
                                    {showResult && (
                                        <div className={`mt-6 p-4 rounded-xl flex items-center gap-3 border animate-slide-up flex-none ${checkCurrentQuestion() ? 'bg-green-50 border-green-100 text-green-900' : 'bg-red-50 border-red-100 text-red-900'}`}>
                                            <div className="shrink-0">{checkCurrentQuestion() ? <Icons.Check className="w-6 h-6"/> : <Icons.X className="w-6 h-6"/>}</div>
                                            <div>
                                                <div className="font-bold text-sm">{checkCurrentQuestion() ? '回答正确' : '回答错误'}</div>
                                                <div className="text-xs font-medium opacity-80 mt-1">{checkCurrentQuestion() ? '记忆准确！' : '正确答案已显示，已加入错题本。'}</div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Buttons - Lifted into scroll view */}
                            <div className="flex gap-3 pb-8">
                                <button onClick={() => setShowHint(!showHint)} className="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-slate-500 hover:bg-slate-50 active:scale-95 transition-transform border border-slate-200 shadow-sm" title="偷看答案">
                                    {showHint ? <Icons.EyeOff className="w-8 h-8"/> : <Icons.Eye className="w-8 h-8"/>}
                                </button>
                                {showResult ? (
                                    <button onClick={nextQuestion} className="flex-1 h-16 bg-indigo-600 text-white rounded-2xl font-bold text-xl shadow-lg shadow-indigo-200 active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                                        下一题 <Icons.ChevronRight className="w-6 h-6"/>
                                    </button>
                                ) : (
                                    <button onClick={handleSubmit} className="flex-1 h-16 bg-slate-900 text-white rounded-2xl font-bold text-xl shadow-lg shadow-slate-300 active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                                        <Icons.Save className="w-6 h-6"/> 提交答案
                                    </button>
                                )}
                            </div>

                         </div>
                    </main>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
